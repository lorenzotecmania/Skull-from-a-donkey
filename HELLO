import pygame
import random

pygame.init()

# Constants
GRID_SIZE = 7
DIFFICULTY = 44

# Set up fullscreen mode and get screen resolution
screen_info = pygame.display.Info()
SCREEN_W, SCREEN_H = screen_info.current_w, screen_info.current_h
screen = pygame.display.set_mode((SCREEN_W, SCREEN_H), pygame.FULLSCREEN)

# Calculate box size based on screen size
BOX_SIZE = min(SCREEN_W, SCREEN_H) // (GRID_SIZE + 1)
BORDER_OFFSET = (min(SCREEN_W, SCREEN_H) - GRID_SIZE * BOX_SIZE) // 2

# Create boxes (grid)
boxes = []
for i in range(GRID_SIZE):  # Outer loop
    for j in range(GRID_SIZE):  # Inner loop
        boxX = i * BOX_SIZE + BORDER_OFFSET + (SCREEN_W - min(SCREEN_W, SCREEN_H)) // 2
        boxY = j * BOX_SIZE + BORDER_OFFSET + (SCREEN_H - min(SCREEN_W, SCREEN_H)) // 2
        box = pygame.Rect(boxX, boxY, BOX_SIZE, BOX_SIZE)
        boxes.append(box)

# Receiver (spawn in the center square of the grid)
center_index = GRID_SIZE**2 // 2 
center_box = boxes[center_index]
receiver = pygame.Rect(center_box.left + 3,
                       center_box.top + 3,
                       BOX_SIZE - 6, BOX_SIZE - 6)



# Player

available_boxes = [box for box in boxes if box != center_box]

player_box = random.choice(available_boxes)
player = pygame.Rect(player_box.left + 3,
                     player_box.top + 3,
                     BOX_SIZE - 6, BOX_SIZE - 6)

#Crates 

available_boxes = [box for box in boxes if box != center_box and box != player_box]

crates = []
for h in range(DIFFICULTY):
    crate_box = random.choice(available_boxes)
    crate = pygame.Rect(crate_box.left + 3, crate_box.top + 3, BOX_SIZE - 6, BOX_SIZE - 6)
    crates.append(crate)
    available_boxes.remove(crate_box)

# Border
border = pygame.Rect(BORDER_OFFSET + (SCREEN_W - min(SCREEN_W, SCREEN_H)) // 2,
                     BORDER_OFFSET + (SCREEN_H - min(SCREEN_W, SCREEN_H)) // 2,
                     GRID_SIZE * BOX_SIZE, GRID_SIZE * BOX_SIZE)


player_selected = False
run = True

# Event handler
while run:
    screen.fill((0, 0, 0))

    # Draw elements
    pygame.draw.rect(screen, (0, 0, 250), receiver)
    pygame.draw.rect(screen, (250, 0, 0), player)

    for crate in crates:
        pygame.draw.rect(screen, (50, 150, 90), crate)

    for box in boxes:
        pygame.draw.rect(screen, "green", box, 3)

    pygame.draw.rect(screen, (0, 250, 0), border, 6)

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            run = False

        if event.type == pygame.MOUSEBUTTONDOWN:
            if player.collidepoint(event.pos):
                player_selected = not player_selected

            elif player_selected and border.collidepoint(event.pos):
                for box in boxes:
                    if box.collidepoint(event.pos):
                        if receiver.colliderect(box):
                            break
                        if any(crate.colliderect(box) for crate in crates):
                            break
                        player.center = box.center
                        break
                player_selected = False

    pygame.display.update()

pygame.quit()
